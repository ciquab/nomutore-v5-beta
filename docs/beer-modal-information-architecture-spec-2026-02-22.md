# ビール記録モーダル 改善仕様（実装前確定版）

作成日: 2026-02-22  
目的: 記録のしやすさを維持したまま、情報密度を整理し、任意入力を無理なく追加できる構成にする。

---

## 0. 仕様の大前提（絶対要件）
1. **未入力項目があっても保存できることを維持する。**
   - ブルワリー名 / 銘柄名 / 評価 / メモ / 味わいプロファイルは任意。
2. **保存後にログ詳細を開き直さないと入力できない設計にしない。**
   - 保存の最短導線（現行）を崩さない。
3. **「記録する」「記録して次へ」の現行導線を維持する。**

---

## 1. 現行構造の整理（as-is）
- ヘッダー: タイトル + 閉じる
- 入力方式タブ: プリセット / カスタム
- スクロール本文: 基本入力 + 任意入力 + 味わい
- 固定フッター: キャンセル / 記録して次へ / 記録する（編集時は削除あり）

課題は、必須入力と任意入力が同階層に並び、初見時の認知負荷が高い点。

---

## 2. 目標構造（to-be）

### 2.1 画面分割はしない（同一モーダル内の段階表示）
- 別ページ・別モーダル遷移は行わない。
- 1つのモーダル内で、以下の2レイヤを見た目で分離する。

### 2.2 レイヤ構成

#### A. クイック記録（常時表示 / 保存に必要）
1. 日付
2. 入力方式（プリセット / カスタム）
3. 量・度数（方式に応じた項目）
4. 本数
5. 推定カロリー借金プレビュー

#### B. 詳細（任意 / 折りたたみ）
1. ブルワリー名
2. 銘柄名
3. 評価
4. テイスティングメモ
5. 味わい4軸（苦味・甘味・フルーティー・ボディ）
6. Untappd関連（検索/トグル）

---

## 3. UI文言仕様

### 3.1 任意セクション見出し
- 見出し: `詳細（任意）`
- 補助文: `未入力でも記録できます`

### 3.2 方式切替補助
- プリセット説明: `スタイルと容量からすばやく記録`
- カスタム説明: `度数と容量を直接入力`

### 3.3 CTA文言（維持）
- `キャンセル`
- `記録して次へ`
- `記録する`

---

## 4. 振る舞い仕様

### 4.1 新規作成時
- 初期表示は「クイック記録」を主表示。
- 「詳細（任意）」はデフォルト折りたたみ。

### 4.2 編集時
- 既存データに詳細入力（評価・メモ・味わい）がある場合、詳細を自動展開してよい。
- 既存データがない場合は折りたたみ維持。

### 4.3 保存時
- 現行の検証ルールを維持する（未来日、ABV、容量、本数の妥当性）。
- 任意項目の空入力は保存可。
- `記録する` は保存して閉じる。
- `記録して次へ` は保存後、日付を維持してフォームを再初期化。

---

## 5. レイアウト詳細（実装ガイド）

### 5.1 本文内セクション順
1. 日付 + 本数
2. 入力方式タブ
3. 方式別入力（プリセット or カスタム）
4. 推定カロリー借金
5. 区切り
6. 詳細（任意）アコーディオン

### 5.2 視覚強度の調整
- クイック記録領域は強調（背景コントラストをやや高め）
- 詳細領域は1段トーンを落とす
- 「保存に必須でない」ことが視覚的に伝わる階層にする

---

## 6. 受け入れ条件（Acceptance Criteria）
1. 任意項目が全空でも、記録が成功する。
2. 保存完了まで、追加画面遷移が発生しない。
3. 現行の2つの保存CTA（記録する / 記録して次へ）が利用可能。
4. 編集時の削除導線が維持される。
5. 味わい入力は任意のまま保持される。

---

## 7. 実装順序（次ステップ）
1. HTMLのセクション構造再編（DOM順のみ整理、IDは極力維持）
2. 見出し/補助文言の追加
3. 折りたたみ既定状態の最終調整（新規時閉 / 編集時条件付き開）
4. 既存保存処理に影響がないことを確認

